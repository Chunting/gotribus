<%@ page language="java" import="java.util.*,model.User,vo.SuperActivity,config.GlobleConfig" pageEncoding="utf-8"%>
<%@ taglib uri="/WEB-INF/tld/c-rt.tld" prefix="c"%>
<%@ taglib prefix="fmt" uri="/WEB-INF/tld/fmt-rt.tld" %>
<%
String path = request.getContextPath();
String basePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
List<SuperActivity> activityList=(List<SuperActivity>)request.getAttribute("activityList");
		User user=(User)session.getAttribute("user");	
		String condition=(String)request.getAttribute("condition");
		String owner=(String)request.getAttribute("owner");
		System.out.println(owner);
request.setAttribute("path1",GlobleConfig.pathPath);
request.setAttribute("path2",GlobleConfig.pathPath1);

%><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    
    
    <title>My JSP 'search_result.jsp' starting page</title>
    
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="expires" content="0">    
	<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
	<meta http-equiv="description" content="This is my page">
	<!--
	<link rel="stylesheet" type="text/css" href="styles.css">
	-->
	    <link rel="stylesheet" type="text/css" media="screen,projection" href="${path1}activity/font/font.css" />
    <link rel="stylesheet" type="text/css" media="screen,projection" href="${path1}activity/css/style.css" />
    <link rel="shortcut icon" href="http://www.gotribus.com/view/images/LOGO_32.png"/>
<script type="text/javascript">
function search(){
var a =document.getElementById("txt1");
window.location.href="${path2}activity/search.action?searchCondition="+a.value;
}


var event1=null;
var event2=null;
 function followActivity(url,id){
  event1=id;

 http_request = false;
    if (window.XMLHttpRequest) {    								// 闈濱E娴忚鍣�
        http_request = new XMLHttpRequest();							//鍒涘缓XMLHttpRequest瀵硅薄
    } else if (window.ActiveXObject) {     							// IE娴忚鍣�
        try {
            http_request = new ActiveXObject("Msxml2.XMLHTTP");		//鍒涘缓XMLHttpRequest瀵硅薄
        } catch (e) {
            try {
                http_request = new ActiveXObject("Microsoft.XMLHTTP");	//鍒涘缓XMLHttpRequest瀵硅薄
           } catch (e) {}
        }
    }
    if (!http_request) {
        alert("cannot create XMLHttpRequest instance锛�");
        return false;
    }
    http_request.onreadystatechange = getResult;							//璋冪敤杩斿洖缁撴灉澶勭悊鍑芥暟
    http_request.open('GET', url, true);								//鍒涘缓涓庢湇鍔″櫒鐨勮繛鎺�
    http_request.send(null);		

    }
function getResult() {
    if (http_request.readyState == 4) {     							// 鍒ゆ柇璇锋眰鐘舵��
        if (http_request.status == 200) {     							// 璇锋眰鎴愬姛锛屽紑濮嬪鐞嗚繑鍥炵粨鏋�
            document.getElementById(event1+"").value=http_request.responseText;	//璁剧疆鎻愮ず鍐呭

        } else {     													// 璇锋眰椤甸潰鏈夐敊璇�
            alert("鎮ㄦ墍璇锋眰鐨勯〉闈㈡湁閿欒锛�");
        }
    }
}

    var event2=null;
 function TribusList(url,id){
  event2=id;
      http_request = false;
    if (window.XMLHttpRequest) {    								// 闈濱E娴忚鍣�
        http_request = new XMLHttpRequest();							//鍒涘缓XMLHttpRequest瀵硅薄
    } else if (window.ActiveXObject) {     							// IE娴忚鍣�
        try {
            http_request = new ActiveXObject("Msxml2.XMLHTTP");		//鍒涘缓XMLHttpRequest瀵硅薄
        } catch (e) {
            try {
                http_request = new ActiveXObject("Microsoft.XMLHTTP");	//鍒涘缓XMLHttpRequest瀵硅薄
           } catch (e) {}
        }
    }
    if (!http_request) {
        alert("涓嶈兘鍒涘缓XMLHttpRequest瀵硅薄瀹炰緥锛�");
        return false;
    }
    http_request.onreadystatechange = getResultTribusList;							//璋冪敤杩斿洖缁撴灉澶勭悊鍑芥暟
    http_request.open('GET', url, true);								//鍒涘缓涓庢湇鍔″櫒鐨勮繛鎺�
    http_request.send(null);	
    }
    
  function   getResultTribusList(){
        if (http_request.readyState == 4) {     							// 鍒ゆ柇璇锋眰鐘舵��
        if (http_request.status == 200) {     							// 璇锋眰鎴愬姛锛屽紑濮嬪鐞嗚繑鍥炵粨鏋�
            document.getElementById(event2+"").innerHTML=http_request.responseText;;	//璁剧疆鎻愮ず鍐呭
 
        } else {     													// 璇锋眰椤甸潰鏈夐敊璇�
            alert("鎮ㄦ墍璇锋眰鐨勯〉闈㈡湁閿欒锛�");
        }
    }
    }
    
    
    
    
 function WishList(url,id){
 event2=id;
      http_request = false;
    if (window.XMLHttpRequest) {    								// 闈濱E娴忚鍣�
        http_request = new XMLHttpRequest();							//鍒涘缓XMLHttpRequest瀵硅薄
    } else if (window.ActiveXObject) {     							// IE娴忚鍣�
        try {
            http_request = new ActiveXObject("Msxml2.XMLHTTP");		//鍒涘缓XMLHttpRequest瀵硅薄
        } catch (e) {
            try {
                http_request = new ActiveXObject("Microsoft.XMLHTTP");	//鍒涘缓XMLHttpRequest瀵硅薄
           } catch (e) {}
        }
    }
    if (!http_request) {
        alert("涓嶈兘鍒涘缓XMLHttpRequest瀵硅薄瀹炰緥锛�");
        return false;
    }
    http_request.onreadystatechange = getResultWishList;							//璋冪敤杩斿洖缁撴灉澶勭悊鍑芥暟
    http_request.open('GET', url, true);								//鍒涘缓涓庢湇鍔″櫒鐨勮繛鎺�
    http_request.send(null);	
    }
    
  function   getResultWishList(){
        if (http_request.readyState == 4) {     							// 鍒ゆ柇璇锋眰鐘舵��
        if (http_request.status == 200) {     							// 璇锋眰鎴愬姛锛屽紑濮嬪鐞嗚繑鍥炵粨鏋�
            document.getElementById(event2+"").innerHTML=http_request.responseText;;	//璁剧疆鎻愮ず鍐呭
 
        } else {     													// 璇锋眰椤甸潰鏈夐敊璇�
            alert("鎮ㄦ墍璇锋眰鐨勯〉闈㈡湁閿欒锛�");
        }
    }
    }
  function joinActivity(url,id1,id2){
    event1=id1;
    event2=id2;

 http_request = false;
    if (window.XMLHttpRequest) {    								// 闈濱E娴忚鍣�
        http_request = new XMLHttpRequest();							//鍒涘缓XMLHttpRequest瀵硅薄
    } else if (window.ActiveXObject) {     							// IE娴忚鍣�
        try {
            http_request = new ActiveXObject("Msxml2.XMLHTTP");		//鍒涘缓XMLHttpRequest瀵硅薄
        } catch (e) {
            try {
                http_request = new ActiveXObject("Microsoft.XMLHTTP");	//鍒涘缓XMLHttpRequest瀵硅薄
           } catch (e) {}
        }
    }
    if (!http_request) {
        alert("涓嶈兘鍒涘缓XMLHttpRequest瀵硅薄瀹炰緥锛�");
        return false;
    }
    http_request.onreadystatechange = getResult1;							//璋冪敤杩斿洖缁撴灉澶勭悊鍑芥暟
    http_request.open('GET', url, true);								//鍒涘缓涓庢湇鍔″櫒鐨勮繛鎺�
    http_request.send(null);		
    
    }
    function getResult1() {
    if (http_request.readyState == 4) {     							// 鍒ゆ柇璇锋眰鐘舵��
        if (http_request.status == 200) {     							// 璇锋眰鎴愬姛锛屽紑濮嬪鐞嗚繑鍥炵粨鏋�
            document.getElementById(event1+"").innerHTML="+  "+http_request.responseText;	//璁剧疆鎻愮ず鍐呭
if(http_request.responseText=="unJoin"){
document.getElementById(event2).innerHTML="+  Unfollow";
}
        } else {     													// 璇锋眰椤甸潰鏈夐敊璇�
            alert("鎮ㄦ墍璇锋眰鐨勯〉闈㈡湁閿欒锛�");
        }
    }
}

  function followActivity(url,id){
    event1=id;

 http_request = false;
    if (window.XMLHttpRequest) {    								// 闈濱E娴忚鍣�
        http_request = new XMLHttpRequest();							//鍒涘缓XMLHttpRequest瀵硅薄
    } else if (window.ActiveXObject) {     							// IE娴忚鍣�
        try {
            http_request = new ActiveXObject("Msxml2.XMLHTTP");		//鍒涘缓XMLHttpRequest瀵硅薄
        } catch (e) {
            try {
                http_request = new ActiveXObject("Microsoft.XMLHTTP");	//鍒涘缓XMLHttpRequest瀵硅薄
           } catch (e) {}
        }
    }
    if (!http_request) {
        alert("涓嶈兘鍒涘缓XMLHttpRequest瀵硅薄瀹炰緥锛�");
        return false;
    }
    http_request.onreadystatechange = getResult2;							//璋冪敤杩斿洖缁撴灉澶勭悊鍑芥暟
    http_request.open('GET', url, true);								//鍒涘缓涓庢湇鍔″櫒鐨勮繛鎺�
    http_request.send(null);		
    
    }
    function getResult2() {
    if (http_request.readyState == 4) {     							// 鍒ゆ柇璇锋眰鐘舵��
        if (http_request.status == 200) {     							// 璇锋眰鎴愬姛锛屽紑濮嬪鐞嗚繑鍥炵粨鏋�
            document.getElementById(event1+"").innerHTML="+  "+http_request.responseText;	//璁剧疆鎻愮ず鍐呭

        } else {     													// 璇锋眰椤甸潰鏈夐敊璇�
            alert("鎮ㄦ墍璇锋眰鐨勯〉闈㈡湁閿欒锛�");
        }
    }
}
function setAtt(id){
  document.getElementById("hiddenField").value=id;
  
  }
 function submit(){
  resourceId=document.getElementById("hiddenField").value;
  typeId=document.getElementById("tribusClassify").value;
   document.form10.action="${path2}/user/addTribusList/city/"+typeId+"/"+rescourceId;
 document.form10.submit();
  closePop();
  }
</script>
  </head>
  
  <body>
  	<div id="wrapper"><!--start wrapper-->
    	<div id="header"><!--start header-->
        	<div class="logo"><a href="${path2}activity/index.action"><img src="${path1}activity/img/logo.png" alt="" /></a></div>
            <div id="header_rgt"><!--start header_rgt-->
            	<div id="menu_bg"><div id="menu_lft"><div id="menu_rgt">
                    <ul>
                    	<li class="current_page_item">
										<a href="${path2}activity/index.action">CITY</a>
									</li>
									<li>
										<a href="${path2}movie/movieHomePage.action" title="MOVIE">MOVIE</a>
									</li>
									<li>
										<a href="${path2}book/bookHomePage.action" title="BOOK">BOOK</a>
									</li>
									<li>
										<a href="${path2}music/musicHomePage.action" title="MUSIC">MUSIC</a>
									</li>
									<li>
										<a href="${path2}user/my.action" title="">MY TRIBUS</a>
									</li>
                    </ul>
                    <div class="header_search">
                    	<form action="${path2}user/searchAll.action">
                        	<p class="txt_header"><input id="search" name="search" type="text" /></p>
                            <p class="submit_header"><input type="submit" value=" " /></p>
                        </form>
                    </div>
                    <div class="header_icon_area">
                    	<span class="space_btm"><a href="#"><img src="${path1}activity/img/icon_header1.png" alt="" /></a></span>
                        <span><a href="${path2}user/editForm.action"><img src="${path1}activity/img/icon_header2.png" alt="" /></a></span>
                    </div>
                </div></div></div>
            </div><!--//end #header_rgt-->
        </div><!--//end #header-->
        <div id="main_area"><!--start main_area-->
        	<div id="saerch_area"><!--start saerch_area-->
            	<div id="search_bg" class="space_lft"><!--start search_bg-->
                	<form action="${path2}activity/search.action">
                    	<p class="search_text"><input id="searchCondition" name="searchCondition" type="text" value="Seach activity, activity time, activity location" onclick="if(this.value=='Seach activity, activity time, activity location')(this.value='')"  onblur="if(this.value=='')(this.value='Seach activity, activity time, activity location')" /></p>
                        <p class="search_submit"><input type="submit" value=" " /></p>
                    </form>
                </div><!--//end #search_bg-->
                <div id="social_media"><!--start social_media-->
                	<div id="social_lftcol">
                    	</div>
   
                    <div id="social_box"><!--start social_box-->
                    	<div id="message">
                        	<a href="${path2}userMail/box/0.action"><img src="${path1}activity/img/icon_message1.jpg" alt="" width="22" height="22" /><c:if test="${unreadMail > 0}">
								<span>${unreadMail}</span>
							</c:if></a>
                        
                            <a href="${path2}user/logout.action"><img src="${path1}activity/img/icon_message4.jpg" alt="" width="22" height="22" /></a>
                        </div>
                        <div class="address">
                        	<h3><%if(user!=null){ %><a href="${path2}user/my.action"><%=user.getUserAlias()%></a><%}else{ %><a href="${path2}user/login.action">login</a><%} %></h3>
                            <span>${userProf.profCity}</span>
                        </div>
                    </div><!--//end #social_box-->
                </div><!--//end #social_media-->
            </div><!--//end #saerch_area-->
            <div id="common_maincontent"><!--start common_maincontent-->
            	<div id="main_search_content"><!--start main_search_content-->
                	<div id="search_lftcol"><!--start search_lftcol-->
                    	<div class="search_title"><!--start search_title-->
                        	<h2>SEARCH: ACTIVITY</h2>
                        	<%if(user!=null){ %><h4><a href="${path2}activity/activityCreatInit.action">Create New</a></h4><%} %>
                            
                        </div><!--//end .search_title-->

                    
    <c:forEach items="${activityList}" var="item" varStatus="index">    
                      <div class="search_post"><!--start search_post-->
                        	<div class="search_post_lft"><a href="${path2}activity/info.action?activityId=${item.activity.activityId} "><img src=${item.activity.activityPic} alt="" width=134 height=179/></a></div>
                            <div class="search_info"><!--start search_info-->
                            	<h2><a href="${path2}activity/info.action?activityId=${item.activity.activityId} ">${item.activity.activityName }</a></h2>
                                <p>${item.activity.activityCity } ,${item.activity.activityStreet }<br />Start Date: <fmt:formatDate value="${item.activity.activityStartTime}" type="date" dateStyle="medium"/> <br />End Date: <fmt:formatDate value="${item.activity.activityFinishTime}" type="date" dateStyle="medium"/></p>
                                <span><a href="${path2}activity/info.action?activityId=${item.activity.activityId} "><img src="${path1}activity/img/tripple_arrow3.jpg" alt="" /></a></span>
                                <ul>
				                    <li>
				                    <c:choose>
                                    <c:when test="${item.owner eq null}" >
                                	
                                	 <a id="at${index.index }"  href="javascript:joinActivity('${path2}activity/joinActivity.action?activityId=${item.activity.activityId }','at${index.index }','bt${index.index }')"><c:choose><c:when test="${item.joined eq true}">+ Unjoin</c:when> <c:otherwise>+ Join</c:otherwise></c:choose>
                                	</c:when >
                                	    <c:otherwise>
                                            You start it
                                          </c:otherwise>
                                          </c:choose></li>
                                             <li><a id="wishList${index.index}"   href="javascript:WishList('${path2}user/addWishList/city/${item.activity.activityId}.action','wishList${index.index}')">+ Wish List</a></li>
                                                        <li><a href="javascript:void(0)" onClick="setAtt(${item.activity.activityId}),showPop()">+ Tribus List</a></li>
                                                    
                                                    </ul>
                                                  <input type="hidden" id="hiddenField"  name="hiddenField" />
                            </div><!--//end .search_info-->
                        </div><!--//end .search_post-->
                      </c:forEach>
                      
                      
                        <div id="follower_apgi">
                            <a  <%if(condition==null){ %>href="${path2}activity/byCityTag.action?page=<c:choose><c:when test="${current-1 == 0}">1</c:when><c:otherwise>${current-1}</c:otherwise></c:choose>&city=${city}" <%}else{ %>href=" ${path2}activity/search.action?page=<c:choose><c:when test="${current-1 == 0}">1</c:when><c:otherwise>${current-1}</c:otherwise></c:choose>&searchCondition=<%=condition %>"<%} %>class="prev"></a>
              <c:forEach items="${pageNumbers}" var="item">
             <%if(condition==null){ %>
             <a href="${path2}activity/byCityTag.action?page=${item}&city=${city}">
             <%}else{ %>
             <a href="${path2}activity/search.action?page=${item}&searchCondition=<%=condition %>"><%} %>
             ${item}
             </a>&nbsp
            </c:forEach>
            
                             <a  <%if(condition==null){ %>href="${path2}activity/byCityTag.action?page=<c:choose><c:when test="${current == maxPage}">${maxPage}</c:when><c:otherwise>${current+1}</c:otherwise></c:choose>&city=${city}" <%}else{ %>href=" ${path2}activity/search.action?page=<c:choose><c:when test="${current == maxPage}">${maxPage}</c:when><c:otherwise>${current+1}</c:otherwise></c:choose>&searchCondition=<%=condition %>"<%} %>class="next"></a>
                    	</div>
                    </div><!--//end #search_lftcol-->
                   
                </div><!--//end #main_search_content-->
            </div><!--//end #common_maincontent-->
            <div id="footer"><p>Copyright @ Tribus.us 2012.      <span>All rights reserved</span> </p></div>
        </div><!--//end #main_area-->
    </div><!--//end #wrapper-->
</body>
</html>
